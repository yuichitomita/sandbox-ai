import gradio as gr
import os
from os.path import join, dirname
from dotenv import load_dotenv
from langchain.agents import load_tools, initialize_agent, AgentType
from langchain.llms import OpenAI
from googletrans import Translator

# APIã‚­ãƒ¼ã®è¨­å®š
dotenv_path = join(dirname(__file__), '.env')
load_dotenv(dotenv_path)

os.environ["OPENAI_API_KEY"] = os.environ.get("API_KEY")

# è¨€èªãƒ¢ãƒ‡ãƒ«(LLM)ã¨ãƒ„ãƒ¼ãƒ«ã‚»ãƒƒãƒˆã‚’åˆæœŸåŒ–
llm = OpenAI(temperature=0)
tools = load_tools(["wikipedia"], llm=llm)
agent = initialize_agent(tools, llm, agent=AgentType.ZERO_SHOT_REACT_DESCRIPTION, verbose=True)

# ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å‡¦ç†ã—ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ç”Ÿæˆã™ã‚‹é–¢æ•°ã‚’å®šç¾©
def langchain_bot(prompt):
    if prompt:
        text = agent.run(prompt)
        return text
    return "ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å…¥åŠ›ã™ã‚‹ã¨Wikipediaé¢¨ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒè¿”ã£ã¦ãã‚‹ã‚ˆ"

# Gradioã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã¨èµ·å‹•
iface = gr.Interface(fn=langchain_bot, 
inputs=gr.inputs.Textbox(lines=5, placeholder="ã“ã“ã«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..."), 
outputs=gr.outputs.Textbox(), title="Wikipedia Langchain Bot ğŸ¦œ",
description="Langchain AIã‚’ä½¿ç”¨ã—ã¦Wikipediaé¢¨ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ç”Ÿæˆ")

# ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã‚’èµ·å‹•
iface.launch()